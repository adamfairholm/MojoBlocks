mojoBlocks={allow_editor_init:true,fallback_contents:[]};mojoBlocks.setup_blocks=function()
{mojoBlocks.gather_contents();if(mojoEditor.is_open)
{mojoBlocks.enable_block_regions();}
jQuery(".mojoblock_region, .mojoblock_global_region").click(function()
{if(mojoBlocks.allow_editor_init==true)
{mojoBlocks.allow_editor_init=false;mojoBlocks.init_editor(this);}});$('#mojo_bar_view_mode, #collapse_tab').live('click',function(){if(mojoEditor.is_open)
{mojoBlocks.allow_editor_init=true;mojoBlocks.enable_block_regions();}
else
{mojoBlocks.allow_editor_init=false;mojoBlocks.disable_block_regions();}});$('#submit_block_form').live('click',function(){mojoBlocks.submit_blocks_form(jQuery(this).attr('class'));});$('#cancel_block_editor').live('click',function(){mojoBlocks.cancel_editor(jQuery(this).attr('class'));});}
mojoBlocks.enable_block_regions=function()
{jQuery(".mojoblock_region").each(function(){block_editable=jQuery("<div class='mojoblock_editable_layer local_mb'></div>").css({opacity:'0.4',width:jQuery(this).width(),height:jQuery(this).outerHeight()}).fadeIn('slow');jQuery(this).prepend(jQuery("<div class='mojo_editable_layer_header'><p>Local: "+$(this).attr('name')+" Block</p></div>")).prepend(block_editable);});jQuery(".mojoblock_global_region").each(function(){block_editable=jQuery("<div class='mojoblock_editable_layer global_mb'></div>").css({opacity:'0.4',width:jQuery(this).width(),height:jQuery(this).outerHeight()}).fadeIn('slow');jQuery(this).prepend(jQuery("<div class='mojo_editable_layer_header'><p>Global: "+$(this).attr('name')+" Block</p></div>")).prepend(block_editable);});};function is_numeric(input)
{return(input-0)==input&&input.length>0;}
mojoBlocks.gather_contents=function()
{jQuery(".mojoblock_region, .mojoblock_global_region").each(function(){r_id=jQuery(this).attr('id');mojoBlocks.fallback_contents[r_id]=jQuery('#'+r_id).html();});}
mojoBlocks.init_editor=function(region){mojoBlocks.disable_block_regions();region_class=jQuery(region).attr('class');region_id=jQuery(region).attr('id');block_type=jQuery(region).attr('name');mojoBlocks.region=region_id;layout_id=Mojo.Vars.layout_id;$('#'+region_id).empty();jQuery.ajax({dataType:"text",type:"POST",data:Mojo.Vars.csrf_token+'='+Mojo.Vars.csrf+'&layout_id='+layout_id+'¨ion_id='+region_id+'&page_url_title='+Mojo.Vars.page_url_title+'&block_type='+block_type+'¨ion_class='+region_class,url:Mojo.URL.site_path+"/addons/mb/editor",success:function(data){$('#'+region_id).html(data);}});mojoBlocks.allow_editor_init=false;}
mojoBlocks.disable_block_regions=function()
{$('.mojoblock_editable_layer').fadeOut(300,function(){$(this).remove();});$('.mojo_editable_layer_header').fadeOut(300,function(){$(this).remove();});};mojoBlocks.cancel_editor=function(region_id){$('#'+region_id).empty();jQuery('#'+region_id).html(mojoBlocks.fallback_contents[region_id]);jQuery('#'+region_id).removeClass('editor_activated');mojoBlocks.enable_block_regions();mojoBlocks.allow_editor_init=true;};mojoBlocks.submit_blocks_form=function(region_id){var $inputs=$('form#mb_editor :input');var data_string='';$inputs.each(function(){data_string+=this.name+'='+escape($(this).val())+'&';});data_string+=Mojo.Vars.csrf_token+'='+Mojo.Vars.csrf+'&form_submit=true';jQuery.ajax({dataType:"text",type:"POST",data:data_string,url:Mojo.URL.site_path+"/addons/mb/editor",success:function(return_data){if(return_data=='BLOCKS_FORM_INPUT_FAILURE')
{alert('An error has occurred. Please try again.');}
else if(is_numeric(return_data)==false)
{$('#'+region_id).html(return_data);}
else
{ajax_block_data='block_id='+return_data+'&'+Mojo.Vars.csrf_token+'='+Mojo.Vars.csrf;jQuery.ajax({dataType:"text",type:"POST",data:ajax_block_data,url:Mojo.URL.site_path+"/addons/mb/ajax_block",success:function(new_data){mojoBlocks.fallback_contents[region_id]=new_data;$('#'+region_id).html(new_data);mojoBlocks.enable_block_regions();mojoBlocks.allow_editor_init=true;}})}}});}